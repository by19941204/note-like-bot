name: Visit note.com

on:
  workflow_dispatch:
    inputs:
      times:
        description: '访问次数'
        default: '10'
  schedule:
    - cron: '*/5 * * * *'  # 每5分钟运行

jobs:
  visit:
    runs-on: ubuntu-latest
    steps:
      - name: Visit page multiple times
        run: |
          URL="https://note.com/funeshiru/n/nc9282c02f880"
          TIMES=${{ github.event.inputs.times || '10' }}
          
          echo "=== 从 GitHub 服务器访问 note.com ==="
          echo "目标: $URL"
          echo "次数: $TIMES"
          echo ""
          
          # 不同的 User-Agent
          UAS=(
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/120.0.0.0 Safari/537.36"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 Chrome/120.0.0.0 Safari/537.36"
            "Mozilla/5.0 (iPhone; CPU iPhone OS 17_2 like Mac OS X) AppleWebKit/605.1.15 Mobile Safari/604.1"
            "Mozilla/5.0 (Linux; Android 14) AppleWebKit/537.36 Chrome/120.0.0.0 Mobile Safari/537.36"
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0"
          )
          
          SUCCESS=0
          FAIL=0
          
          for i in $(seq 1 $TIMES); do
            UA_INDEX=$((($i - 1) % 5))
            UA="${UAS[$UA_INDEX]}"
            
            STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$URL?_t=$(date +%s)&_r=$RANDOM" \
              -H "User-Agent: $UA" \
              -H "Accept-Language: ja,en;q=0.9")
            
            if [ "$STATUS" = "200" ]; then
              SUCCESS=$((SUCCESS + 1))
              echo "✓ #$i 状态:$STATUS"
            else
              FAIL=$((FAIL + 1))
              echo "✗ #$i 状态:$STATUS"
            fi
            
            # 随机延迟 1-3 秒
            sleep $((1 + RANDOM % 3))
          done
          
          echo ""
          echo "=== 结果 ==="
          echo "成功: $SUCCESS"
          echo "失败: $FAIL"
