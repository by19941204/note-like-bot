name: Visit note.com

on:
  workflow_dispatch:
  schedule:
    - cron: '*/5 * * * *'

jobs:
  # 今天24:00后停止
  check-date:
    runs-on: ubuntu-latest
    outputs:
      should_run: ${{ steps.check.outputs.should_run }}
    steps:
      - id: check
        run: |
          NOW=$(TZ=Asia/Tokyo date +%s)
          END=$(TZ=Asia/Tokyo date -d "2026-02-05 00:00:00" +%s)
          if [ $NOW -lt $END ]; then
            echo "should_run=true" >> $GITHUB_OUTPUT
          else
            echo "should_run=false" >> $GITHUB_OUTPUT
            echo "⏰ 已到期"
          fi

  # 冬休み: 20-26次 (目标约2500)
  visit-article1:
    needs: check-date
    if: needs.check-date.outputs.should_run == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Visit n939384d205b5
        run: |
          URL="https://note.com/funeshiru/n/n939384d205b5"
          TIMES=$((20 + RANDOM % 7))
          
          UAS=(
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (iPhone; CPU iPhone OS 17_3 like Mac OS X) AppleWebKit/605.1.15"
            "Mozilla/5.0 (Linux; Android 14; Pixel 8) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (iPad; CPU OS 17_3 like Mac OS X) AppleWebKit/605.1.15"
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 14_3) AppleWebKit/605.1.15 Safari/605.1.15"
            "Mozilla/5.0 (Linux; Android 14; SM-S918B) AppleWebKit/537.36 Chrome/122.0.0.0"
          )
          
          for i in $(seq 1 $TIMES); do
            UA="${UAS[$((RANDOM % 8))]}"
            curl -s -o /dev/null "$URL?_t=$RANDOM$RANDOM" -H "User-Agent: $UA"
            sleep $((1 + RANDOM % 2))
          done
          echo "冬休み: $TIMES visits"

  # カフェ: 26-32次 (目标约3100 - 最多)
  visit-article2:
    needs: check-date
    if: needs.check-date.outputs.should_run == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Visit n708d5812b976
        run: |
          URL="https://note.com/funeshiru/n/n708d5812b976"
          TIMES=$((26 + RANDOM % 7))
          
          UAS=(
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (iPhone; CPU iPhone OS 17_3 like Mac OS X) AppleWebKit/605.1.15"
            "Mozilla/5.0 (Linux; Android 14; Pixel 8) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (iPad; CPU OS 17_3 like Mac OS X) AppleWebKit/605.1.15"
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 14_3) AppleWebKit/605.1.15 Safari/605.1.15"
            "Mozilla/5.0 (Linux; Android 14; SM-S918B) AppleWebKit/537.36 Chrome/122.0.0.0"
          )
          
          for i in $(seq 1 $TIMES); do
            UA="${UAS[$((RANDOM % 8))]}"
            curl -s -o /dev/null "$URL?_t=$RANDOM$RANDOM" -H "User-Agent: $UA"
            sleep $((1 + RANDOM % 2))
          done
          echo "カフェ: $TIMES visits"

  # 展示会: 16-22次 (目标约2000 - 最少)
  visit-article3:
    needs: check-date
    if: needs.check-date.outputs.should_run == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Visit n81d639277d5e
        run: |
          URL="https://note.com/funeshiru/n/n81d639277d5e"
          TIMES=$((16 + RANDOM % 7))
          
          UAS=(
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (iPhone; CPU iPhone OS 17_3 like Mac OS X) AppleWebKit/605.1.15"
            "Mozilla/5.0 (Linux; Android 14; Pixel 8) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (iPad; CPU OS 17_3 like Mac OS X) AppleWebKit/605.1.15"
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 14_3) AppleWebKit/605.1.15 Safari/605.1.15"
            "Mozilla/5.0 (Linux; Android 14; SM-S918B) AppleWebKit/537.36 Chrome/122.0.0.0"
          )
          
          for i in $(seq 1 $TIMES); do
            UA="${UAS[$((RANDOM % 8))]}"
            curl -s -o /dev/null "$URL?_t=$RANDOM$RANDOM" -H "User-Agent: $UA"
            sleep $((1 + RANDOM % 2))
          done
          echo "展示会: $TIMES visits"

  # 館長: 22-28次 (目标约2700)
  visit-article4:
    needs: check-date
    if: needs.check-date.outputs.should_run == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Visit nc9282c02f880
        run: |
          URL="https://note.com/funeshiru/n/nc9282c02f880"
          TIMES=$((22 + RANDOM % 7))
          
          UAS=(
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (iPhone; CPU iPhone OS 17_3 like Mac OS X) AppleWebKit/605.1.15"
            "Mozilla/5.0 (Linux; Android 14; Pixel 8) AppleWebKit/537.36 Chrome/122.0.0.0"
            "Mozilla/5.0 (iPad; CPU OS 17_3 like Mac OS X) AppleWebKit/605.1.15"
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 14_3) AppleWebKit/605.1.15 Safari/605.1.15"
            "Mozilla/5.0 (Linux; Android 14; SM-S918B) AppleWebKit/537.36 Chrome/122.0.0.0"
          )
          
          for i in $(seq 1 $TIMES); do
            UA="${UAS[$((RANDOM % 8))]}"
            curl -s -o /dev/null "$URL?_t=$RANDOM$RANDOM" -H "User-Agent: $UA"
            sleep $((1 + RANDOM % 2))
          done
          echo "館長: $TIMES visits"
