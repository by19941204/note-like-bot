name: Like note.com

on:
  workflow_dispatch:
  schedule:
    - cron: '*/30 * * * *'

jobs:
  # 检查是否过期 (2月8日后停止)
  check-date:
    runs-on: ubuntu-latest
    outputs:
      should_run: ${{ steps.check.outputs.should_run }}
    steps:
      - id: check
        run: |
          NOW=$(date +%s)
          END=$(($(date -d "2026-02-09 00:00:00" +%s)))
          if [ $NOW -lt $END ]; then
            echo "should_run=true" >> $GITHUB_OUTPUT
          else
            echo "should_run=false" >> $GITHUB_OUTPUT
            echo "⏰ 已到期，停止运行"
          fi

  # 文章1: 每次都点赞
  like-article1:
    needs: check-date
    if: needs.check-date.outputs.should_run == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Like n939384d205b5
        run: |
          NOTE_KEY="n939384d205b5"
          NOTE_URL="https://note.com/funeshiru/n/${NOTE_KEY}"
          LIKE_API="https://note.com/api/v3/notes/${NOTE_KEY}/likes"
          
          curl -s -c /tmp/c.txt "$NOTE_URL" -H "User-Agent: Mozilla/5.0" > /dev/null
          curl -s -X POST "$LIKE_API" -b /tmp/c.txt \
            -H "Content-Type: application/json" \
            -H "Origin: https://note.com" -H "Referer: $NOTE_URL" -d '{}'
          echo "Done: $NOTE_KEY"

  # 文章2: 50%概率点赞（更多增长）
  like-article2:
    needs: check-date
    if: needs.check-date.outputs.should_run == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Like n708d5812b976 (random)
        run: |
          if [ $((RANDOM % 2)) -eq 0 ]; then
            NOTE_KEY="n708d5812b976"
            NOTE_URL="https://note.com/funeshiru/n/${NOTE_KEY}"
            LIKE_API="https://note.com/api/v3/notes/${NOTE_KEY}/likes"
            curl -s -c /tmp/c.txt "$NOTE_URL" -H "User-Agent: Mozilla/5.0" > /dev/null
            curl -s -X POST "$LIKE_API" -b /tmp/c.txt \
              -H "Content-Type: application/json" \
              -H "Origin: https://note.com" -H "Referer: $NOTE_URL" -d '{}'
            echo "Done: $NOTE_KEY"
          else
            echo "Skipped: n708d5812b976"
          fi

  # 文章3: 30%概率点赞
  like-article3:
    needs: check-date
    if: needs.check-date.outputs.should_run == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Like n81d639277d5e (random)
        run: |
          if [ $((RANDOM % 10)) -lt 3 ]; then
            NOTE_KEY="n81d639277d5e"
            NOTE_URL="https://note.com/funeshiru/n/${NOTE_KEY}"
            LIKE_API="https://note.com/api/v3/notes/${NOTE_KEY}/likes"
            curl -s -c /tmp/c.txt "$NOTE_URL" -H "User-Agent: Mozilla/5.0" > /dev/null
            curl -s -X POST "$LIKE_API" -b /tmp/c.txt \
              -H "Content-Type: application/json" \
              -H "Origin: https://note.com" -H "Referer: $NOTE_URL" -d '{}'
            echo "Done: $NOTE_KEY"
          else
            echo "Skipped: n81d639277d5e"
          fi

  # 文章4: 20%概率点赞（已经很多了）
  like-article4:
    needs: check-date
    if: needs.check-date.outputs.should_run == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Like nc9282c02f880 (random)
        run: |
          if [ $((RANDOM % 10)) -lt 2 ]; then
            NOTE_KEY="nc9282c02f880"
            NOTE_URL="https://note.com/funeshiru/n/${NOTE_KEY}"
            LIKE_API="https://note.com/api/v3/notes/${NOTE_KEY}/likes"
            curl -s -c /tmp/c.txt "$NOTE_URL" -H "User-Agent: Mozilla/5.0" > /dev/null
            curl -s -X POST "$LIKE_API" -b /tmp/c.txt \
              -H "Content-Type: application/json" \
              -H "Origin: https://note.com" -H "Referer: $NOTE_URL" -d '{}'
            echo "Done: $NOTE_KEY"
          else
            echo "Skipped: nc9282c02f880"
          fi
