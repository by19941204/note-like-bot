name: Like note.com

on:
  workflow_dispatch:  # 手动触发
  schedule:
    - cron: '*/30 * * * *'  # 每30分钟运行一次

jobs:
  like:
    runs-on: ubuntu-latest
    steps:
      - name: Send like request
        run: |
          echo "=== 点赞 note.com ==="
          
          # 获取初始点赞数
          INITIAL=$(curl -s "https://note.com/api/v3/notes/nc9282c02f880" | python3 -c "import sys,json; print(json.load(sys.stdin).get('data',{}).get('like_count',0))")
          echo "初始点赞: $INITIAL"
          
          # 访问页面获取cookie
          COOKIE=$(curl -s -c - "https://note.com/funeshiru/n/nc9282c02f880" | grep _note_session | awk '{print $6"="$7}')
          
          # 发送点赞
          RESULT=$(curl -s -X POST "https://note.com/api/v3/notes/nc9282c02f880/likes" \
            -H "Content-Type: application/json" \
            -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36" \
            -H "Origin: https://note.com" \
            -H "Referer: https://note.com/funeshiru/n/nc9282c02f880" \
            -H "Cookie: $COOKIE" \
            -d '{}')
          
          echo "结果: $RESULT"
          
          # 获取最终点赞数
          sleep 2
          FINAL=$(curl -s "https://note.com/api/v3/notes/nc9282c02f880" | python3 -c "import sys,json; print(json.load(sys.stdin).get('data',{}).get('like_count',0))")
          echo "最终点赞: $FINAL"
          echo "增加: +$((FINAL - INITIAL))"
